---
import { supabase } from "../db/supabase";

// Función auxiliar
async function fetchToolsByType(type: string) {
  const { data, error } = await supabase
    .from("tools")
    .select("*")
    .eq("type", type)
    .eq("visible", true)
    .order("name");

  if (error) console.error(`Error fetching ${type} tools:`, error);
  return data || [];
}

// Cargar categorías en paralelo
const categories = [
  { type: "Frontend", title: "Frontend" },
  { type: "Backend", title: "Backend" },
  { type: "Database", title: "Database" },
  { type: "Framework", title: "Frameworks" }
];

const results = await Promise.all(
  categories.map(c => fetchToolsByType(c.type))
);

// Mezclamos categorías + resultados
const sections = categories.map((c, i) => ({
  ...c,
  tools: results[i]
}));
---
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-15">
    {sections.map(({ title, tools }) => (
      <div class="mb-0">
        <span class="text-xl font-bold mb-6 ">{title}</span>

      {tools.length > 0 ? (
        <div class="flex overflow-x-auto snap-x scroll-smooth scroll-pl-6 gap-8 pb-4 custom-scrollbar">
          {tools.map(tool => (
            <div class="flex-none snap-start">
              <div class="flex flex-col items-center space-y-3 min-w-[65px]">
                <div class="w-16 h-16 flex items-center justify-center">
                  {tool.icon ? (
                    <img src={tool.icon} alt={`${tool.name} icon`} class="w-12 h-12" />
                  ) : (
                    <svg viewBox="0 0 24 24" class="w-12 h-12">
                      <path fill="currentColor" d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                    </svg>
                  )}
                </div>
                <h3>{tool.name}</h3>
              </div>
            </div>
          ))}
        </div>
      ) : (
        <div class="text-center py-4">No {title.toLowerCase()} tools found.</div>
      )}
      </div>
    ))}

  <style>
  /* Estilos para el scrollbar */
  .custom-scrollbar {
    scrollbar-width: thin;
    scrollbar-color: rgba(156, 163, 175, 0.5) rgba(243, 244, 246, 0.1);
  }

  .custom-scrollbar::-webkit-scrollbar {
    height: 6px;
    width: 6px;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: rgba(243, 244, 246, 0.1);
    border-radius: 8px;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: rgba(156, 163, 175, 0.5);
    border-radius: 8px;
    border: 2px solid transparent;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: rgba(107, 114, 128, 0.7);
  }

  
</style>

